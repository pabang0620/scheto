generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id             Int          @id @default(autoincrement())
  email          String       @unique
  name           String
  password       String
  role           String       @default("employee")
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  company        Company?
  employee       Employee?
  reviewedLeaves Leave[]      @relation("reviewer")
  readNotices    NoticeRead[]
  createdNotices Notice[]     @relation("NoticeCreator")

  @@map("users")
}

model Company {
  id                          Int            @id @default(autoincrement())
  userId                      Int            @unique
  companyName                 String
  industry                    String
  companySize                 String
  address                     String?
  phone                       String?
  createdAt                   DateTime       @default(now())
  defaultEndTime              String?        @default("18:00")
  defaultStartTime            String?        @default("09:00")
  minStaffRequired            Int?
  showLeaveInSchedule         Boolean        @default(false)
  updatedAt                   DateTime       @updatedAt
  workDays                    Json?
  workType                    String         @default("flexible")
  allowEmployeeSelfScheduling Boolean        @default(false)
  autoSchedulingEnabled       Boolean        @default(false)
  complianceRequirements      Json?
  holidaySchedule             Json?
  maxAdvanceScheduleDays      Int            @default(30)
  minimumStaffCoverage        Float          @default(1)
  operatingHours              Json?
  overtimePolicy              Json?
  peakHours                   Json?
  scheduleNotificationDays    Int            @default(7)
  timezone                    String         @default("UTC")
  unionRules                  Json?
  user                        User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  shiftPatterns               ShiftPattern[]

  @@map("companies")
}

model Employee {
  id                 Int                     @id @default(autoincrement())
  userId             Int                     @unique
  name               String
  email              String                  @unique
  department         String
  position           String
  phone              String?
  address            String?
  hireDate           DateTime                @default(now())
  yearsOfExperience  Int                     @default(0)
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt
  employeeType       String                  @default("full-time")
  isActive           Boolean                 @default(true)
  maxConsecutiveDays Int                     @default(5)
  maxDailyHours      Int                     @default(8)
  minDailyHours      Int                     @default(4)
  minRestHours       Int                     @default(12)
  seniorityLevel     String                  @default("junior")
  weeklyHoursTarget  Int                     @default(40)
  abilities          Ability?
  certifications     EmployeeCertification[]
  chemistry1         EmployeeChemistry[]     @relation("Employee1Chemistry")
  chemistry2         EmployeeChemistry[]     @relation("Employee2Chemistry")
  constraints        EmployeeConstraints?
  notes              EmployeeNote[]
  user               User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  leaves             Leave[]
  preferences        Preference?
  schedules          Schedule[]

  @@map("employees")
}

model Ability {
  id              Int      @id @default(autoincrement())
  employeeId      Int      @unique
  customerService Int      @default(1)
  experience      Int      @default(1)
  flexibility     Int      @default(1)
  rank            String?
  teamChemistry   Int      @default(1)
  totalScore      Int?
  workSkill       Int      @default(1)
  employee        Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("abilities")
}

model Preference {
  id           Int      @id @default(autoincrement())
  employeeId   Int      @unique
  preferDays   Json
  avoidDays    Json
  fixedOffDays Json
  employee     Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("preferences")
}

model Schedule {
  id                Int            @id @default(autoincrement())
  employeeId        Int
  date              DateTime       @db.Date
  startTime         String
  endTime           String
  shiftType         String         @default("regular")
  notes             String?        @db.Text
  status            String         @default("scheduled")
  createdBy         Int?
  updatedBy         Int?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  breakTime         String?
  estimatedWorkload String?
  generationLogId   Int?
  isAutoGenerated   Boolean        @default(false)
  overtimeApproved  Boolean        @default(false)
  priority          String         @default("normal")
  shiftPatternId    Int?
  swapRequested     Boolean        @default(false)
  employee          Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  generationLog     GenerationLog? @relation("GeneratedSchedules", fields: [generationLogId], references: [id])
  shiftPattern      ShiftPattern?  @relation("ShiftPatternSchedules", fields: [shiftPatternId], references: [id])

  @@index([date, employeeId])
  @@index([employeeId, date, startTime])
  @@index([shiftPatternId])
  @@index([generationLogId])
  @@index([isAutoGenerated])
  @@map("schedules")
}

model Leave {
  id           Int       @id @default(autoincrement())
  employeeId   Int
  startDate    DateTime  @db.Date
  endDate      DateTime  @db.Date
  type         String
  reason       String?
  status       String    @default("pending")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  adminComment String?
  reviewedAt   DateTime?
  reviewedBy   Int?
  employee     Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  reviewer     User?     @relation("reviewer", fields: [reviewedBy], references: [id])

  @@index([employeeId], map: "leaves_employeeId_fkey")
  @@index([reviewedBy], map: "leaves_reviewedBy_fkey")
  @@map("leaves")
}

model EmployeeNote {
  id         Int      @id @default(autoincrement())
  employeeId Int
  type       String
  content    String   @db.Text
  priority   String
  createdBy  Int
  createdAt  DateTime @default(now())
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId], map: "employee_notes_employeeId_fkey")
  @@map("employee_notes")
}

model EmployeeChemistry {
  id          Int      @id @default(autoincrement())
  employee1Id Int
  employee2Id Int
  score       Int      @default(3)
  employee1   Employee @relation("Employee1Chemistry", fields: [employee1Id], references: [id], onDelete: Cascade)
  employee2   Employee @relation("Employee2Chemistry", fields: [employee2Id], references: [id], onDelete: Cascade)

  @@unique([employee1Id, employee2Id])
  @@index([employee2Id], map: "employee_chemistry_employee2Id_fkey")
  @@map("employee_chemistry")
}

model Notice {
  id          Int          @id @default(autoincrement())
  title       String
  content     String       @db.Text
  type        String
  priority    String
  isPinned    Boolean      @default(false)
  createdBy   Int
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  expiresAt   DateTime?
  readByUsers NoticeRead[]
  creator     User         @relation("NoticeCreator", fields: [createdBy], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([type])
  @@index([priority])
  @@index([isPinned])
  @@index([createdBy], map: "notices_createdBy_fkey")
  @@map("notices")
}

model NoticeRead {
  id       Int      @id @default(autoincrement())
  noticeId Int
  userId   Int
  readAt   DateTime @default(now())
  notice   Notice   @relation(fields: [noticeId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([noticeId, userId])
  @@index([userId])
  @@map("notice_reads")
}

model ShiftPattern {
  id                 Int                @id @default(autoincrement())
  name               String
  description        String?            @db.Text
  startTime          String
  endTime            String
  duration           Int
  breakDuration      Int                @default(0)
  shiftType          String
  industryType       String?
  isTemplate         Boolean            @default(false)
  color              String             @default("#007bff")
  createdBy          Int
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  companyId          Int?
  days               Json
  enabled            Boolean            @default(true)
  requiredStaff      Int                @default(1)
  requirements       Json?
  schedules          Schedule[]         @relation("ShiftPatternSchedules")
  company            Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  schedule_templates ScheduleTemplate[] @relation("templateshiftpatterns")

  @@index([shiftType])
  @@index([industryType])
  @@index([isTemplate])
  @@index([companyId], map: "shift_patterns_companyId_fkey")
  @@map("shift_patterns")
}

model ScheduleTemplate {
  id                   Int             @id @default(autoincrement())
  name                 String
  description          String?         @db.Text
  industryType         String
  templateType         String
  isActive             Boolean         @default(true)
  metadata             Json?
  workDaysPattern      Json
  rotationPeriod       Int?            @default(7)
  minStaffPerShift     Int             @default(1)
  maxStaffPerShift     Int?
  coverageRequirements Json?
  createdBy            Int
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
  generationLogs       GenerationLog[]
  shift_patterns       ShiftPattern[]  @relation("templateshiftpatterns")

  @@index([industryType])
  @@index([templateType])
  @@index([isActive])
  @@map("schedule_templates")
}

model EmployeeConstraints {
  id                    Int      @id @default(autoincrement())
  employeeId            Int      @unique
  unavailableTimeSlots  Json?
  preferredTimeSlots    Json?
  blackoutDates         Json?
  preferredShiftTypes   Json?
  avoidShiftTypes       Json?
  canWorkWeekends       Boolean  @default(true)
  canWorkHolidays       Boolean  @default(true)
  canWorkNightShifts    Boolean  @default(true)
  maxShiftsPerWeek      Int      @default(5)
  maxOvertimeHours      Int      @default(10)
  requiresFixedSchedule Boolean  @default(false)
  fixedShiftPattern     String?
  maxTravelTime         Int?
  workLocation          String?
  hasReliableTransport  Boolean  @default(true)
  needsAccommodation    Boolean  @default(false)
  accommodationDetails  String?  @db.Text
  medicalRestrictions   Json?
  certificationRequired Json?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  employee              Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("employee_constraints")
}

model GenerationLog {
  id                     Int               @id @default(autoincrement())
  templateId             Int?
  generatedBy            Int
  generationType         String
  periodStart            DateTime          @db.Date
  periodEnd              DateTime          @db.Date
  totalSchedulesCreated  Int               @default(0)
  totalEmployeesAffected Int               @default(0)
  parameters             Json
  constraints            Json?
  coverageAchieved       Float?
  employeeSatisfaction   Float?
  constraintViolations   Json?
  warnings               Json?
  errors                 Json?
  executionTime          Int?
  algorithmVersion       String            @default("v1.0")
  status                 String            @default("completed")
  notes                  String?           @db.Text
  createdAt              DateTime          @default(now())
  template               ScheduleTemplate? @relation(fields: [templateId], references: [id])
  schedules              Schedule[]        @relation("GeneratedSchedules")

  @@index([generatedBy])
  @@index([periodStart, periodEnd])
  @@index([status])
  @@index([createdAt])
  @@index([templateId], map: "generation_logs_templateId_fkey")
  @@map("generation_logs")
}

model EmployeeCertification {
  id                 Int       @id @default(autoincrement())
  employeeId         Int
  certificationName  String
  certificationBody  String?
  issueDate          DateTime  @db.Date
  expiryDate         DateTime? @db.Date
  certificateNumber  String?
  isActive           Boolean   @default(true)
  verificationStatus String    @default("pending")
  attachmentUrl      String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  employee           Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([certificationName])
  @@index([expiryDate])
  @@index([isActive])
  @@map("employee_certifications")
}
