# 🕐 시간대별 인원관리 및 영업시간 연동 기능 설계

## 📋 현재 상황 분석

### ✅ 기존에 있는 것들
- `operatingHours`: 영업시간 정보 (JSON)
- `peakHours`: 피크시간 정보 (JSON)  
- `workDays`: 근무 요일 (JSON)
- `minimumStaffCoverage`: 기본 최소 인력
- `minStaffPerShift`: 교대별 최소 인원

### ❌ 부족한 것들
- **시간대별 세밀한 인원 설정** (현재는 교대별로만 가능)
- **영업시간과 스케줄링 완전 연동** (설정은 있지만 자동생성에 미반영)
- **동적 인원 조정** (피크시간 vs 일반시간 구분)
- **실시간 커버리지 계산**
- **인원 부족/과다 경고 시스템**

---

## 🎯 제안하는 개선 기능들

### 1. 시간대별 세밀한 인원 관리
```
기능: 30분/1시간 단위로 필요 인원 설정
목적: 영업시간 내 모든 시간대의 적정 인력 보장

예시:
09:00-10:00: 최소 2명, 권장 3명
10:00-11:00: 최소 2명, 권장 3명  
11:00-12:00: 최소 3명, 권장 4명 (점심 전 피크)
12:00-13:00: 최소 4명, 권장 5명 (점심시간 피크)
13:00-14:00: 최소 3명, 권장 4명
...
```

### 2. 영업시간 기반 자동 시간대 생성
```
기능: 영업시간을 설정하면 자동으로 시간대별 인원 템플릿 생성
목적: 설정의 편의성과 일관성 확보

예시:
영업시간: 09:00-22:00 → 자동으로 26개 시간대 생성 (30분 단위)
```

### 3. 피크타임 자동 인원 증원
```  
기능: 피크시간 설정 시 해당 시간대 자동 인원 증원
목적: 바쁜 시간대의 서비스 품질 보장

예시:
일반시간: 3명 → 피크시간: 5명 (67% 증원)
```

### 4. 실시간 커버리지 대시보드
```
기능: 현재/미래 시간대별 인원 현황을 실시간으로 표시
목적: 관리자의 신속한 의사결정 지원

표시 내용:
- 시간대별 현재 배정 인원
- 최소/권장 인원 대비 상태  
- 부족/과다 인원 경고
- 커버리지 퍼센티지
```

---

## 🗄️ 데이터베이스 구조 개선안

### 새로운 테이블: TimeSlotRequirements
```sql
model TimeSlotRequirement {
  id          Int     @id @default(autoincrement())
  companyId   Int
  dayOfWeek   Int     // 0=일요일, 1=월요일...
  timeSlot    String  // "09:00-09:30" 형태
  minStaff    Int     @default(1)
  optimalStaff Int    @default(2)
  maxStaff    Int?    @default(5)
  priority    String  @default("normal") // "low", "normal", "high", "critical"
  notes       String?
  isActive    Boolean @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  company     Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@unique([companyId, dayOfWeek, timeSlot])
  @@map("time_slot_requirements")
}
```

### Company 테이블 확장
```sql
// 기존 필드에 추가
timeSlotInterval    Int      @default(60)  // 30분 또는 60분 단위
autoStaffAdjustment Boolean  @default(true) // 피크시간 자동 증원
coverageThreshold   Float    @default(0.8)  // 커버리지 경고 임계값
```

---

## 🎨 UI/UX 설계안

### 1. 회사 설정 페이지 개선

#### 1-1. 영업시간 설정 섹션
```
📍 기본 영업시간
┌─────────────────────────────────────┐
│ 월-금: [09:00] - [22:00]            │
│ 토요일: [10:00] - [20:00]           │  
│ 일요일: [ 휴무 ]                    │
└─────────────────────────────────────┘

⚙️ 고급 설정
☑️ 시간대별 세부 인원 관리 활성화
☑️ 피크시간 자동 증원 (50% 증원)
☐ 점심시간 교대 근무 (12:00-14:00)
```

#### 1-2. 시간대별 인원 설정 테이블
```
🕐 시간대별 필요 인원 (월요일 기준)
┌──────────┬─────┬─────┬─────┬────────┐
│ 시간대   │ 최소│ 권장│ 최대│ 우선순위│
├──────────┼─────┼─────┼─────┼────────┤
│ 09:00-10:00│ [2] │ [3] │ [4] │ 보통   │
│ 10:00-11:00│ [2] │ [3] │ [4] │ 보통   │
│ 11:00-12:00│ [3] │ [4] │ [5] │ 높음   │
│ 12:00-13:00│ [4] │ [5] │ [6] │ 높음   │ ← 점심시간 피크
│ 13:00-14:00│ [3] │ [4] │ [5] │ 높음   │
│ 14:00-15:00│ [2] │ [3] │ [4] │ 보통   │
└──────────┴─────┴─────┴─────┴────────┘

🔄 [다른 요일에 복사] [템플릿 저장] [일괄 적용]
```

### 2. 스케줄 자동생성 페이지 개선

#### 2-1. 커버리지 미리보기
```
📊 예상 커버리지 (2024-08-20 월요일)
┌────────────────────────────────────────┐
│ 09:00 ████████░░ 80% (2/3명)          │
│ 10:00 ██████████ 100% (3/3명)         │  
│ 11:00 ████████░░ 80% (4/5명) ⚠️       │
│ 12:00 ██████░░░░ 60% (3/5명) ❌       │ ← 인원 부족
│ 13:00 ████████░░ 80% (4/5명) ⚠️       │
└────────────────────────────────────────┘

전체 커버리지: 80% (권장: 90% 이상)
```

#### 2-2. 인원 배치 옵션
```
🎯 자동 배치 설정
☑️ 시간대별 최소 인원 보장
☑️ 피크시간 우선 배치  
☑️ 경험자-신입 균형 배치
☐ 초과 근무 허용

⚠️ 경고 설정
☑️ 커버리지 80% 미만시 경고
☑️ 연속 3시간 이상 인원 부족시 알림
```

### 3. 실시간 대시보드

#### 3-1. 커버리지 모니터링
```
🎛️ 실시간 인력 현황 (08-20 14:30 기준)

현재 시간대 (14:00-15:00)
┌─────────────────────────────────────┐
│ 배정 인원: 3명 ✅                   │
│ 권장 인원: 3명                      │
│ 커버리지: 100% ✅                   │
└─────────────────────────────────────┘

다음 시간대 (15:00-16:00)  
┌─────────────────────────────────────┐
│ 배정 인원: 2명 ⚠️                   │
│ 권장 인원: 4명                      │  
│ 커버리지: 50% ❌                    │
│ [긴급 배정 요청] 버튼               │
└─────────────────────────────────────┘
```

---

## ⚙️ 백엔드 로직 개선안

### 1. 시간대별 인원 계산 알고리즘
```javascript
// 시간대별 필요 인원 계산
const calculateTimeSlotRequirements = (date, timeSlot) => {
  const dayOfWeek = date.getDay();
  const requirement = await getTimeSlotRequirement(dayOfWeek, timeSlot);
  
  // 피크시간 체크
  const isPeakTime = await checkPeakTime(timeSlot);
  
  let minStaff = requirement.minStaff;
  let optimalStaff = requirement.optimalStaff;
  
  if (isPeakTime && company.autoStaffAdjustment) {
    minStaff = Math.ceil(minStaff * 1.5);      // 50% 증원
    optimalStaff = Math.ceil(optimalStaff * 1.5);
  }
  
  return { minStaff, optimalStaff, priority: requirement.priority };
};
```

### 2. 자동생성 로직 확장
```javascript
// 기존 점수 계산에 시간대 우선순위 추가
const calculateEmployeeScore = (employee, date, timeSlot) => {
  let score = calculateBasicScore(employee); // 기존 로직
  
  // 시간대별 우선순위 보너스
  const requirement = getTimeSlotRequirement(date.getDay(), timeSlot);
  if (requirement.priority === 'high') {
    score += employee.abilities.customerService * 2; // 고우선순위는 고객서비스 중시
  } else if (requirement.priority === 'critical') {
    score += employee.abilities.experience * 3;      // 긴급상황은 경험 중시
  }
  
  return score;
};
```

### 3. 커버리지 실시간 계산
```javascript
// 시간대별 커버리지 계산
const calculateCoverage = async (date) => {
  const timeSlots = generateTimeSlots(company.operatingHours);
  const coverage = {};
  
  for (const slot of timeSlots) {
    const requirement = await getTimeSlotRequirement(date.getDay(), slot);
    const assigned = await getAssignedStaff(date, slot);
    
    coverage[slot] = {
      required: requirement.optimalStaff,
      assigned: assigned.length,
      percentage: (assigned.length / requirement.optimalStaff) * 100,
      status: assigned.length >= requirement.minStaff ? 'ok' : 'warning'
    };
  }
  
  return coverage;
};
```

---

## 🚀 구현 단계별 계획

### Phase 1: 기본 구조 (2주)
1. ✅ 데이터베이스 스키마 추가 (`TimeSlotRequirement` 테이블)
2. ✅ 기본 CRUD API 구현
3. ✅ 회사 설정 페이지 UI 개선
4. ✅ 시간대별 인원 설정 인터페이스

### Phase 2: 자동생성 연동 (2주)  
1. ✅ 자동생성 알고리즘에 시간대별 요구사항 반영
2. ✅ 커버리지 계산 로직 구현
3. ✅ 미리보기 기능 개발
4. ✅ 인원 부족 경고 시스템

### Phase 3: 고도화 (2주)
1. ✅ 실시간 대시보드 구현  
2. ✅ 피크시간 자동 증원 로직
3. ✅ 긴급 배정 요청 기능
4. ✅ 커버리지 통계 및 리포트

### Phase 4: 최적화 (1주)
1. ✅ 성능 최적화 (대용량 데이터 처리)
2. ✅ 모바일 UI 개선
3. ✅ 사용자 피드백 반영
4. ✅ 문서화 완료

---

## 💡 예상 효과

### 관리자 입장
- ⏰ **정확한 인력 계획**: 시간대별 정확한 인원 배치로 효율성 극대화
- 📊 **실시간 모니터링**: 인력 부족/과다 상황을 즉시 파악
- 🎯 **자동화된 최적화**: 수동 조정 없이도 적정 인력 유지
- 💰 **비용 절감**: 불필요한 인력 배치 방지로 인건비 절약

### 직원 입장  
- ⚖️ **공정한 배치**: 시스템 기반 객관적 배정으로 불만 해소
- 🔄 **예측 가능성**: 미리 정해진 패턴으로 개인 계획 수립 용이
- 💪 **적정 업무량**: 피크시간 증원으로 과도한 업무 부담 방지

### 고객 입장
- ⭐ **서비스 품질 향상**: 적정 인력으로 대기시간 단축
- 🕐 **일정한 서비스**: 시간대별 일관된 서비스 품질 보장

---

## 🤔 구현시 고려사항

### 기술적 고려사항
1. **데이터베이스 성능**: 시간대별 세분화로 인한 데이터 급증
2. **실시간 계산**: 커버리지 계산의 성능 최적화 필요
3. **캐싱 전략**: 자주 조회되는 시간대 정보의 효율적 캐싱
4. **확장성**: 여러 매장/지점 관리시 확장 가능한 구조

### 비즈니스 고려사항  
1. **업종별 특성**: 업종에 따른 피크시간 패턴 차이
2. **계절적 변동**: 시기별 인력 수요 변화 반영 방안
3. **법적 제약**: 근로기준법상 연속근무시간 제한 준수
4. **비용 대비 효과**: 세밀한 관리의 추가 비용 vs 효율성 증대

### 사용성 고려사항
1. **설정의 복잡성**: 너무 복잡한 설정으로 인한 사용자 부담
2. **학습 곡선**: 새로운 기능에 대한 사용자 교육 필요
3. **기존 워크플로우**: 현재 사용 중인 프로세스와의 호환성
4. **오류 허용성**: 잘못된 설정시 자동 보정 또는 경고 필요

---

**이 설계안이 어떠신가요? 특히 어떤 부분을 우선적으로 구현하고 싶으신지 알려주시면 더 구체적인 개발 계획을 세워드릴 수 있습니다!** 🚀